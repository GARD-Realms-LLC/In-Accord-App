<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>InAccord Launcher</title>
    <style>
      /* Dark mode */
      :root {
        --bg: #0f1220;
        --panel: #161724;
        --muted: #9aa0b4;
        --text: #e6eef8;
        --accent: #4f8ef7;
        --danger: #e06c75;
      }
      html,body { height:100%; margin:0; }
      /* Force-hide all scrollbars (strong rule) but keep internal scrolling where needed */
      :root, html, body { overflow: hidden !important; }
      /* Apply to all elements: remove scrollbar visuals (webkit, firefox, IE) */
      * { -ms-overflow-style: none !important; scrollbar-width: none !important; }
      *::-webkit-scrollbar { width: 0 !important; height: 0 !important; }
      *::-webkit-scrollbar-thumb { background: transparent !important; border: 0 !important; }
      /* Center the whole app (vertical + horizontal) and stack content */
      body { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px; padding:24px; box-sizing:border-box; font-family: "Segoe UI", Arial, sans-serif; background: var(--bg); color: var(--text); }

      /* Center container (everything except console) */
      .centered { max-width:720px; margin:0 auto; padding:20px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:10px; box-shadow: 0 6px 24px rgba(0,0,0,0.6); text-align:center; }
      .splashWrap { margin-bottom:12px; }
      .splash { max-width:100%; height:160px; object-fit:contain; border-radius:6px; display:inline-block; }

      .row { margin: 8px 0; display:flex; align-items:center; justify-content:center; gap:10px; }
      label { color: var(--muted); }
      select, input[type="radio"] { background: var(--panel); color: var(--text); border: 1px solid rgba(255,255,255,0.04); padding:6px 8px; border-radius:6px; }

      .actions { margin-top: 16px; display:flex; gap:8px; justify-content:center; }
      button { padding: 8px 14px; border-radius:8px; border: none; background: linear-gradient(180deg,var(--accent), #256bd6); color: white; cursor: pointer; font-weight:600; }
      button#cancelBtn { background: rgba(255,255,255,0.04); color: var(--muted); }

      /* Console output centered and visually distinct; hide its scrollbar but keep scrolling */
      .console { margin: 12px auto; width: 90%; min-height:200px; max-height:300px; background: #0b0d14; color: var(--muted); padding:12px; border-radius:8px; box-sizing:border-box; overflow:auto; text-align:left; white-space:pre-wrap; -ms-overflow-style: none; scrollbar-width: none; }
      .console::-webkit-scrollbar { width: 0px; height: 0px; }
      .consoleWrap { width: 90%; margin: 12px auto; position: relative; }
      .resize-handle { position: absolute; right: 8px; bottom: 8px; width: 14px; height: 14px; background: linear-gradient(135deg,#e0e0e0,#cfcfcf); border-radius:3px; cursor: se-resize; box-shadow: 0 1px 2px rgba(0,0,0,0.4); opacity: 0.9; }
      .resize-handle:hover { opacity: 1; }

      .consoleActions { width: 90%; margin: 6px auto 0 auto; display:flex; justify-content:flex-end; }
      .btn-copy { padding:6px 10px; border-radius:6px; border:none; background: rgba(255,255,255,0.03); color: var(--muted); cursor:pointer; }

      /* Footer icon bar */
      .footer { width: 90%; margin: 8px auto 24px auto; display:flex; justify-content:center; gap:12px; align-items:center; }
      .icon-link { color: var(--muted); display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:8px; background: rgba(255,255,255,0.02); text-decoration:none; }
      .icon-link:hover { color: var(--accent); background: rgba(79,142,247,0.08); }
      .icon-svg { width:20px; height:20px; }

      /* Make inputs focus-visible in dark theme */
      select:focus, button:focus, input[type="radio"]:focus { outline: 2px solid rgba(79,142,247,0.18); }
    </style>
  </head>
  <body>
    <div class="centered">
      <h3>InAccord Launcher</h3>
      <div class="splashWrap">
        <img id="splash" alt="InAccord" class="splash" />
      </div>

      <div class="row">
        <label for="channel">Select Discord:</label>
        <select id="channel">
          <option value="stable" selected>Stable</option>
          <option value="ptb">PTB</option>
          <option value="canary">Canary</option>
          <option value="mac">Mac</option>
          <option value="linux">Linux</option>
        </select>
      </div>

      <div class="row">
        <label>Target OS:</label>
        <label><input type="radio" name="os" value="win32" checked /> Windows</label>
        <label><input type="radio" name="os" value="darwin" /> Mac</label>
        <label><input type="radio" name="os" value="linux" /> Linux</label>
      </div>

      <div class="actions">
        <button id="installBtn">Install InAccord</button>
        <button id="launchBtn">Launch Client</button>
        <button id="cancelBtn">Cancel</button>
      </div>
    </div>

    <!-- Console / output stays centered below the centered content -->
    <div class="consoleActions">
      <button id="copyBtn" class="btn-copy">Copy</button>
      <button id="changelogBtn" class="btn-copy" title="Open changelog">Changelog</button>
    </div>
    <div class="consoleWrap">
      <pre id="output" class="console"></pre>
      <div id="resizeHandle" class="resize-handle" title="Resize status box"></div>
    </div>

    <!-- Footer text + icons (centered) -->
    <div class="footer">
      <div class="footerText">In-Accord © 2025 / 2026 | G.A.R.D. Realms LLC</div>
      <a class="icon-link" id="githubLink" href="#" data-url="https://github.com/GARD-Realms-LLC/In-Accord-App" title="GitHub">
        <!-- GitHub SVG -->
        <svg class="icon-svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 .5C5.73.5.75 5.48.75 11.77c0 4.93 3.19 9.11 7.61 10.59.56.1.76-.24.76-.53 0-.26-.01-.95-.01-1.86-3.09.67-3.74-.73-3.98-1.4-.13-.34-.7-1.4-1.2-1.68-.41-.22-1-.77-.01-.79.93-.02 1.6.86 1.82 1.22 1.06 1.82 2.75 1.3 3.42.99.11-.78.41-1.3.75-1.6-2.77-.31-5.68-1.39-5.68-6.17 0-1.36.49-2.47 1.3-3.34-.13-.32-.57-1.61.12-3.35 0 0 1.06-.34 3.48 1.28 1.01-.28 2.09-.42 3.16-.42 1.07 0 2.15.14 3.16.42 2.42-1.62 3.48-1.28 3.48-1.28.69 1.74.25 3.03.12 3.35.81.87 1.3 1.98 1.3 3.34 0 4.79-2.92 5.85-5.7 6.16.42.36.8 1.07.8 2.16 0 1.56-.01 2.82-.01 3.2 0 .29.2.64.77.53 4.42-1.49 7.61-5.66 7.61-10.59C23.25 5.48 18.27.5 12 .5z"/></svg>
      </a>
      <a class="icon-link" id="discordLink" href="#" data-url="https://discord.com/channels/1418648743544094871" title="Discord Server">
        <!-- Discord SVG -->
        <svg class="icon-svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M20.317 4.369a19.791 19.791 0 00-4.885-1.515.07.07 0 00-.075.037c-.21.375-.444.864-.608 1.249-1.844-.276-3.68-.276-5.486 0-.164-.396-.418-.874-.628-1.249a.07.07 0 00-.075-.037 19.736 19.736 0 00-4.885 1.515.064.064 0 00-.03.027C2.99 9.045 2.17 13.57 2.67 18.053c.042.27.17.54.387.73a19.9 19.9 0 005.993 3.02.07.07 0 00.078-.027c.463-.63.873-1.297 1.219-1.994a.07.07 0 00-.038-.098 13.06 13.06 0 01-1.872-.892.07.07 0 01-.007-.116c.126-.094.252-.19.374-.287a.07.07 0 01.076-.007c3.93 1.78 8.18 1.78 12.032 0a.07.07 0 01.078.007c.122.097.248.193.374.287a.07.07 0 01-.007.116c-.57.36-1.176.7-1.872.892a.07.07 0 00-.038.098c.36.695.77 1.364 1.219 1.994a.07.07 0 00.078.027 19.9 19.9 0 005.993-3.02c.217-.19.345-.46.387-.73.5-4.484-.32-9.009-2.927-13.657a.063.063 0 00-.03-.027zM8.02 15.331c-1.182 0-2.156-1.085-2.156-2.419 0-1.333.955-2.418 2.156-2.418 1.21 0 2.183 1.095 2.156 2.418 0 1.334-.955 2.419-2.156 2.419zm7.975 0c-1.182 0-2.156-1.085-2.156-2.419 0-1.333.955-2.418 2.156-2.418 1.21 0 2.183 1.095 2.156 2.418 0 1.334-.946 2.419-2.156 2.419z"/></svg>
      </a>
      <a class="icon-link" id="websiteLink" href="#" data-url="http://www.in-accord.net" title="Website">
        <!-- Globe SVG -->
        <svg class="icon-svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zm5.93 6h-3.02a15.9 15.9 0 00-1.16-3.02A8.02 8.02 0 0117.93 8zM12 4.07c.63 1.05 1.18 2.4 1.63 3.93H10.37c.45-1.53 1-2.88 1.63-3.93zM6.07 8A8.02 8.02 0 016.25 5.98 15.9 15.9 0 005.09 9H2.07A8.04 8.04 0 016.07 8zM4.07 12c0-.34.02-.67.06-1h3.06c-.03.33-.05.66-.05 1s.02.67.05 1H4.13c-.04-.33-.06-.66-.06-1zm1.98 4h3.02a15.9 15.9 0 001.16 3.02A8.02 8.02 0 016.05 16zM12 19.93c-.63-1.05-1.18-2.4-1.63-3.93h3.26c-.45 1.53-1 2.88-1.63 3.93zM17.93 16a8.02 8.02 0 01-3.02 2.02c-.45-1.05-1-2.4-1.63-3.93h3.02c.04.33.06.66.06 1z"/></svg>
      </a>
      <a class="icon-link" id="donateLink" href="#" data-url="https://www.gofundme.com/" title="Donate">
        <!-- Donate (heart/hand) SVG -->
        <svg class="icon-svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 21s-7.5-4.35-9.5-7.5C.94 9.94 6 4.5 12 8c6-3.5 11.06 1.94 9 5.5C19.5 16.65 12 21 12 21z"/></svg>
      </a>
      <a class="icon-link" id="emailLink" href="#" data-url="mailto:docrst@gmail.com" title="Email">
        <!-- Email SVG -->
        <svg class="icon-svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
      </a>
    </div>

    <script>
      const channelEl = document.getElementById('channel');
      const installBtn = document.getElementById('installBtn');
      const launchBtn = document.getElementById('launchBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const output = document.getElementById('output');
      const splash = document.getElementById('splash');

      // Default changelog metadata shown in the status box
      const CHANGELOG_URL = 'https://github.com/GARD-Realms-LLC/In-Accord-App';
      const CHANGELOG_VERSION = '0.0.1';
      const CHANGELOG_DATE = '2026-02-18';
      const RECENT_CHANGES = [
        'Initial launcher build',
        'Added changelog and footer links',
        'External links open via OS default handler',
      ];

      function append(text) { output.textContent += text + '\n'; }

      // Initialize console with changelog metadata
      (function initChangelog() {
        try {
          let txt = '';
          txt += 'Changelog: ' + CHANGELOG_URL + '\n';
          txt += 'Version: ' + CHANGELOG_VERSION + '\n';
          txt += 'Date: ' + CHANGELOG_DATE + '\n\n';
          txt += 'Recent changes:\n';
          RECENT_CHANGES.forEach(c => { txt += ' - ' + c + '\n'; });
          txt += '\n';
          output.textContent = txt;
        } catch (e) { /* ignore */ }
      })();

      // Try several likely locations for the splash image (packaged vs dev)
      (function trySplash() {
        // Prefer absolute workspace image path first (user-provided), then packaged-relative paths
        const candidates = ['E:/InAccord-Apps/Images/splash.jpg','E:\\InAccord-Apps\\Images\\splash.jpg','Images/splash.jpg','../Images/splash.jpg','../../Images/splash.jpg','./Images/splash.jpg'];
        let i = 0;
        function tryNext() {
          if (i >= candidates.length) { splash.style.display='none'; return; }
          const src = candidates[i++];
          const img = new Image();
          img.onload = () => { splash.src = src; };
          img.onerror = () => tryNext();
          img.src = src;
        }
        tryNext();
      })();

      installBtn.addEventListener('click', async () => {
        const ch = channelEl.value;
        const osSel = document.querySelector('input[name="os"]:checked').value;
        append('Installing for ' + ch + ' on ' + osSel + '...');
        const res = await window.iaLauncher.install(ch, osSel);
        append('Exit code: ' + res.code);
        append(res.output || '(no output)');
        if (res.code !== 0) window.iaLauncher.showError('Install failed — see output');
      });

      launchBtn.addEventListener('click', async () => {
        const ch = channelEl.value;
        const osSel = document.querySelector('input[name="os"]:checked').value;
        append('Launching ' + ch + ' on ' + osSel + '...');
        const res = await window.iaLauncher.launch(ch, osSel);
        append('Exit code: ' + res.code);
        append(res.output || '(no output)');
        if (res.code !== 0) window.iaLauncher.showError('Launch failed — see output');
      });

      cancelBtn.addEventListener('click', () => { window.close(); });

      const copyBtn = document.getElementById('copyBtn');
      copyBtn.addEventListener('click', async () => {
        const text = output.textContent || '';
        try {
          // Use the Electron main clipboard via preload for reliability
          if (window.iaLauncher && window.iaLauncher.copyToClipboard) {
            const res = await window.iaLauncher.copyToClipboard(text);
            if (res && res.ok) append('Copied output to clipboard');
            else append('Copy failed: ' + (res && res.error ? res.error : 'unknown'));
          } else if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(text);
            append('Copied output to clipboard (navigator)');
          } else {
            const ta = document.createElement('textarea');
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            append('Copied output to clipboard (fallback)');
          }
        } catch (err) {
          append('Copy failed: ' + String(err));
        }
      });

      // Changelog button opens the GitHub repo using the external handler
      const changelogBtn = document.getElementById('changelogBtn');
      changelogBtn.addEventListener('click', async (ev) => {
        ev.preventDefault();
        try {
          if (window.iaLauncher && window.iaLauncher.openExternal) {
            const res = await window.iaLauncher.openExternal(CHANGELOG_URL);
            if (!res || !res.ok) append('Failed to open changelog: ' + (res && res.error ? res.error : 'unknown'));
          } else {
            window.open(CHANGELOG_URL, '_blank', 'noopener,noreferrer');
          }
        } catch (err) { append('open changelog error: ' + String(err)); }
      });

      // Resize handle logic for the status box (drag vertically)
      (function enableResizeHandle() {
        const handle = document.getElementById('resizeHandle');
        if (!handle) return;
        const out = document.getElementById('output');
        if (!out) return;
        out.style.maxHeight = '400px';
        out.style.height = out.offsetHeight + 'px';
        let startY = 0;
        let startH = 0;
        let resizing = false;
        handle.addEventListener('mousedown', (e) => {
          resizing = true; startY = e.clientY; startH = out.offsetHeight; document.body.style.userSelect = 'none';
        });
        window.addEventListener('mousemove', (e) => {
          if (!resizing) return; const delta = startY - e.clientY; const newH = Math.max(80, startH + delta); out.style.height = newH + 'px';
        });
        window.addEventListener('mouseup', () => { if (resizing) { resizing = false; document.body.style.userSelect = ''; } });
        // touch support
        handle.addEventListener('touchstart', (e) => { resizing = true; startY = e.touches[0].clientY; startH = out.offsetHeight; });
        window.addEventListener('touchmove', (e) => { if (!resizing) return; const delta = startY - e.touches[0].clientY; const newH = Math.max(80, startH + delta); out.style.height = newH + 'px'; });
        window.addEventListener('touchend', () => { resizing = false; });
      })();

      // Auto-run removed; user must click Install or Launch.
      // Wire footer icon clicks to openExternal via preload bridge
      function openIcon(id) {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener('click', async (ev) => {
          ev.preventDefault();
          const url = el.getAttribute('data-url');
          if (!url) return;
          try {
            if (window.iaLauncher && window.iaLauncher.openExternal) {
              const res = await window.iaLauncher.openExternal(url);
              if (!res || !res.ok) append('Failed to open: ' + (res && res.error ? res.error : 'unknown'));
            } else {
              // fallback to window.open
              window.open(url, '_blank', 'noopener,noreferrer');
            }
          } catch (err) {
            append('openExternal error: ' + String(err));
          }
        });
      }
      ['githubLink','discordLink','websiteLink','donateLink','emailLink'].forEach(openIcon);
    </script>
  </body>
</html>
